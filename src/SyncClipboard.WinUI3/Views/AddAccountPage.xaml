<?xml version="1.0" encoding="utf-8" ?>
<Page x:Class="SyncClipboard.WinUI3.Views.AddAccountPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:ui="using:CommunityToolkit.WinUI.Controls"
      xmlns:i18n="using:SyncClipboard.Core.I18n"
      xmlns:vm="using:SyncClipboard.Core.ViewModels"
      xmlns:vc="using:SyncClipboard.WinUI3.ValueConverters"
      MinWidth="550"
      d:DataContext="{d:DesignInstance vm:AddAccountViewModel}"
      BorderBrush="Transparent"
      mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="24" Spacing="16">
                <!--  服务器地址  -->
                <ui:SettingsCard Header="服务器地址">
                    <ui:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE12B;" />
                    </ui:SettingsCard.HeaderIcon>
                    <StackPanel Spacing="8">
                        <TextBox Text="{x:Bind _viewModel.ServerUrl, Mode=TwoWay}" PlaceholderText="https://example.com" IsEnabled="{x:Bind vc:ConvertMethod.BoolNegate(_viewModel.IsLoading), Mode=OneWay}" />
                        <TextBlock Text="请输入服务器地址，例如: https://your-server.com" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </ui:SettingsCard>

                <!--  用户名  -->
                <ui:SettingsCard Header="{x:Bind i18n:Strings.UserName}">
                    <ui:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE13D;" />
                    </ui:SettingsCard.HeaderIcon>
                    <TextBox Text="{x:Bind _viewModel.Username, Mode=TwoWay}" PlaceholderText="用户名" IsEnabled="{x:Bind vc:ConvertMethod.BoolNegate(_viewModel.IsLoading), Mode=OneWay}" />
                </ui:SettingsCard>

                <!--  密码  -->
                <ui:SettingsCard Header="{x:Bind i18n:Strings.Password}">
                    <ui:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE1F6;" />
                    </ui:SettingsCard.HeaderIcon>
                    <StackPanel Spacing="8">
                        <PasswordBox Password="{x:Bind _viewModel.Password, Mode=TwoWay}" PlaceholderText="密码" IsEnabled="{x:Bind vc:ConvertMethod.BoolNegate(_viewModel.IsLoading), Mode=OneWay}" />
                        <TextBlock Text="请输入密码或应用程序专用密码" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </ui:SettingsCard>

                <!--  测试连接  -->
                <ui:SettingsCard Header="连接测试">
                    <ui:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE9D2;" />
                    </ui:SettingsCard.HeaderIcon>
                    <StackPanel Spacing="8">
                        <Button Content="测试连接" Command="{x:Bind _viewModel.TestConnectionCommand}" IsEnabled="{x:Bind vc:ConvertMethod.BoolNegate(_viewModel.IsLoading), Mode=OneWay}" />
                        <TextBlock Text="测试服务器连接和认证信息是否正确" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </StackPanel>
                </ui:SettingsCard>
            </StackPanel>
        </ScrollViewer>

        <!--  底部按钮  -->
        <Border Grid.Row="1"
                Padding="24,16"
                Background="{ThemeResource LayerFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,1,0,0">
            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal" Spacing="12">
                <Button Content="{x:Bind i18n:Strings.Cancel}" Command="{x:Bind _viewModel.CancelCommand}" IsEnabled="{x:Bind vc:ConvertMethod.BoolNegate(_viewModel.IsLoading), Mode=OneWay}" />
                <Button Content="{x:Bind i18n:Strings.Confirm}"
                        Style="{StaticResource AccentButtonStyle}"
                        Command="{x:Bind _viewModel.AddAccountCommand}"
                        IsEnabled="{x:Bind vc:ConvertMethod.BoolNegate(_viewModel.IsLoading), Mode=OneWay}" />
            </StackPanel>
        </Border>

        <!--  加载指示器  -->
        <Border Grid.RowSpan="2" Background="{ThemeResource SmokeFillColorDefaultBrush}" Visibility="{x:Bind vc:ConvertMethod.BoolToVisibility(_viewModel.IsLoading), Mode=OneWay}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16">
                <ProgressRing IsActive="True" />
                <TextBlock HorizontalAlignment="Center" Text="正在添加账号..." />
            </StackPanel>
        </Border>
    </Grid>
</Page>